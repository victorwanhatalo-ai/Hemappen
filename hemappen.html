<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
<meta name="googlebot" content="noindex, nofollow">
<title>Hemappen</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f7ff;
  --white: #ffffff;
  --navy: #1a1f3c;
  --text: #2d3250;
  --muted: #8890b0;
  --border: #e4e8f5;
  --bills: #ff6b6b;
  --bills-light: #fff0f0;
  --savings: #06d6a0;
  --savings-light: #e8fdf7;
  --food: #ffa62b;
  --food-light: #fff5e6;
  --shop: #748ffc;
  --shop-light: #eef0ff;
  --shadow: 0 4px 20px rgba(26,31,60,0.08);
  --shadow-lg: 0 8px 32px rgba(26,31,60,0.13);
  --radius: 18px;
  --radius-sm: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Nunito', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  max-width: 480px;
  margin: 0 auto;
  padding-bottom: 90px;
}

/* â”€â”€ HEADER â”€â”€ */
.app-header {
  background: var(--navy);
  color: white;
  padding: 20px 20px 28px;
  position: relative;
  overflow: hidden;
}
.app-header::after {
  content: '';
  position: absolute;
  bottom: -20px; left: 0; right: 0;
  height: 40px;
  background: var(--bg);
  border-radius: 50% 50% 0 0 / 100% 100% 0 0;
}
.header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.app-name { font-size: 1.5rem; font-weight: 900; letter-spacing: -0.5px; }
.header-date { font-size: 0.8rem; opacity: 0.6; }
.header-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.sum-card {
  background: rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  padding: 12px 14px;
  backdrop-filter: blur(4px);
}
.sum-label { font-size: 0.72rem; opacity: 0.7; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
.sum-value { font-size: 1.3rem; font-weight: 800; }

/* â”€â”€ NAV â”€â”€ */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 50%; transform: translateX(-50%);
  width: 100%; max-width: 480px;
  background: var(--white);
  border-top: 1px solid var(--border);
  display: flex;
  box-shadow: 0 -4px 20px rgba(26,31,60,0.08);
  z-index: 100;
}
.nav-btn {
  flex: 1;
  display: flex; flex-direction: column; align-items: center;
  padding: 10px 0 8px;
  border: none; background: none; cursor: pointer;
  color: var(--muted);
  font-family: 'Nunito', sans-serif;
  font-size: 0.68rem; font-weight: 700;
  gap: 3px;
  transition: color 0.2s;
}
.nav-btn.active { color: var(--navy); }
.nav-icon { font-size: 1.35rem; }
.nav-btn.active .nav-icon { transform: scale(1.15); }

/* â”€â”€ SCREENS â”€â”€ */
.screen { display: none; padding: 16px 16px 0; animation: slideUp 0.25s ease; }
.screen.active { display: block; }
@keyframes slideUp { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

.screen-title {
  font-size: 1.4rem; font-weight: 900;
  margin-bottom: 16px;
  letter-spacing: -0.3px;
}

/* â”€â”€ CARDS â”€â”€ */
.card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
  box-shadow: var(--shadow);
}

/* â”€â”€ FORM ELEMENTS â”€â”€ */
.form-row { display: flex; gap: 8px; margin-bottom: 12px; }
.inp {
  flex: 1;
  padding: 12px 14px;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  font-family: 'Nunito', sans-serif;
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text);
  background: var(--bg);
  outline: none;
  transition: border-color 0.2s;
}
.inp:focus { border-color: var(--navy); }
.inp::placeholder { color: var(--muted); font-weight: 400; }

.btn-add {
  padding: 12px 18px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: 'Nunito', sans-serif;
  font-size: 1.1rem;
  font-weight: 800;
  cursor: pointer;
  transition: transform 0.15s, opacity 0.15s;
  white-space: nowrap;
}
.btn-add:active { transform: scale(0.95); opacity: 0.85; }

/* â”€â”€ LIST ITEMS â”€â”€ */
.list-item {
  display: flex; align-items: center; gap: 12px;
  padding: 13px 14px;
  background: var(--white);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  box-shadow: var(--shadow);
  animation: slideUp 0.2s ease;
}
.item-check {
  width: 24px; height: 24px;
  border-radius: 8px;
  border: 2.5px solid var(--border);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.8rem;
  flex-shrink: 0;
  transition: all 0.15s;
}
.item-check.checked { background: var(--savings); border-color: var(--savings); color: white; }
.item-text { flex: 1; font-weight: 700; font-size: 0.95rem; }
.item-text.checked-text { text-decoration: line-through; color: var(--muted); }
.item-sub { font-size: 0.78rem; color: var(--muted); font-weight: 600; }
.item-amount { font-weight: 800; font-size: 1rem; flex-shrink: 0; }
.item-del {
  background: none; border: none; cursor: pointer;
  font-size: 1rem; color: var(--muted); padding: 4px;
  transition: color 0.15s;
}
.item-del:hover { color: var(--bills); }

/* â”€â”€ PROGRESS BAR â”€â”€ */
.prog-wrap { margin-top: 10px; }
.prog-labels { display: flex; justify-content: space-between; font-size: 0.78rem; font-weight: 700; color: var(--muted); margin-bottom: 6px; }
.prog-bar { height: 10px; background: var(--bg); border-radius: 999px; overflow: hidden; border: 1px solid var(--border); }
.prog-fill { height: 100%; border-radius: 999px; transition: width 0.5s ease; }

/* â”€â”€ BADGE â”€â”€ */
.badge {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 3px 10px;
  border-radius: 999px;
  font-size: 0.72rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.04em;
}

/* â”€â”€ SECTION HEADER â”€â”€ */
.sec-header {
  display: flex; justify-content: space-between; align-items: center;
  margin-bottom: 10px;
}
.sec-title { font-size: 1rem; font-weight: 800; }

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty {
  text-align: center; padding: 28px 16px;
  color: var(--muted); font-weight: 600; font-size: 0.9rem;
}
.empty-icon { font-size: 2.5rem; margin-bottom: 8px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: HEM (Dashboard)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
.dash-tile {
  border-radius: var(--radius);
  padding: 16px;
  cursor: pointer;
  transition: transform 0.15s;
}
.dash-tile:active { transform: scale(0.97); }
.dash-tile-icon { font-size: 1.8rem; margin-bottom: 8px; }
.dash-tile-label { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; }
.dash-tile-value { font-size: 1.2rem; font-weight: 900; margin-top: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BILLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bill-item-paid { opacity: 0.5; }

/* â”€â”€ SPLASH SCREEN â”€â”€ */
.splash {
  position: fixed; inset: 0; z-index: 999;
  background: var(--navy);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 32px;
  animation: fadeIn 0.3s ease;
}
.splash.hidden { display: none; }
.splash-logo { font-size: 3.5rem; margin-bottom: 12px; }
.splash-title { font-family: 'Nunito', sans-serif; font-size: 1.8rem; font-weight: 900; color: white; margin-bottom: 6px; }
.splash-sub { font-size: 0.9rem; color: rgba(255,255,255,0.55); margin-bottom: 40px; font-weight: 600; }
.splash-question { font-size: 1rem; font-weight: 800; color: rgba(255,255,255,0.8); margin-bottom: 16px; }
.splash-btns { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 280px; }
.splash-btn {
  padding: 16px; border: none; border-radius: var(--radius);
  font-family: 'Nunito', sans-serif; font-size: 1.05rem; font-weight: 800;
  cursor: pointer; transition: transform 0.15s, opacity 0.15s;
  display: flex; align-items: center; justify-content: center; gap: 10px;
}
.splash-btn:active { transform: scale(0.97); opacity: 0.85; }
.splash-btn-p1 { background: #eef2ff; color: #6366f1; }
.splash-btn-p2 { background: #fdf2f8; color: #ec4899; }

/* â”€â”€ ACTIVE USER CHIP â”€â”€ */
.active-user-chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 10px 4px 6px;
  border-radius: 999px;
  font-size: 0.78rem; font-weight: 800;
  cursor: pointer;
  transition: opacity 0.15s;
}
.active-user-chip:active { opacity: 0.7; }
.person-picker { display:flex; gap:8px; margin-bottom:12px; }
.person-btn {
  flex:1; padding:10px; border-radius:var(--radius-sm);
  border:2px solid var(--border); background:var(--bg);
  font-family:'Nunito',sans-serif; font-size:0.88rem; font-weight:800;
  cursor:pointer; transition:all 0.15s; color:var(--muted);
}
.person-btn.selected-p1 { border-color:#6366f1; background:#eef2ff; color:#6366f1; }
.person-btn.selected-p2 { border-color:#ec4899; background:#fdf2f8; color:#ec4899; }
.person-tag {
  font-size:0.7rem; font-weight:800; padding:2px 7px;
  border-radius:999px; white-space:nowrap; flex-shrink:0;
}
.tag-p1 { background:#eef2ff; color:#6366f1; }
.tag-p2 { background:#fdf2f8; color:#ec4899; }
.tag-both { background:#f0fdf4; color:#16a34a; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.goal-card { cursor: default; }
.goal-name { font-size: 1rem; font-weight: 800; margin-bottom: 2px; }
.goal-amounts { font-size: 0.82rem; color: var(--muted); font-weight: 600; margin-bottom: 8px; }
.goal-actions { display: flex; gap: 8px; margin-top: 10px; }
.goal-btn {
  flex: 1; padding: 9px; border: none; border-radius: 10px;
  font-family: 'Nunito', sans-serif; font-size: 0.82rem; font-weight: 800;
  cursor: pointer; transition: opacity 0.15s;
}
.goal-btn:active { opacity: 0.75; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(26,31,60,0.45); backdrop-filter: blur(3px);
  z-index: 200; align-items: center; justify-content: center;
}
.modal-overlay.open { display: flex; animation: fadeIn 0.2s ease; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
.modal-box {
  background: var(--white); border-radius: var(--radius);
  padding: 24px; width: 88%; max-width: 340px;
  box-shadow: var(--shadow-lg);
  animation: slideUp 0.25s ease;
}
.modal-title { font-size: 1.1rem; font-weight: 900; margin-bottom: 6px; }
.modal-sub { font-size: 0.85rem; color: var(--muted); margin-bottom: 16px; }
.modal-actions { display: flex; gap: 8px; margin-top: 14px; }
.modal-btn {
  flex: 1; padding: 12px; border: none; border-radius: var(--radius-sm);
  font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 800;
  cursor: pointer; transition: opacity 0.15s;
}
.modal-btn:active { opacity: 0.75; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KALENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-nav { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; }
.cal-month { font-size:1.1rem; font-weight:900; }
.cal-arrow { background:var(--bg); border:1px solid var(--border); border-radius:8px; width:34px; height:34px; font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:background 0.15s; }
.cal-arrow:hover { background:var(--border); }
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:3px; }
.cal-day-name { text-align:center; font-size:0.68rem; font-weight:800; color:var(--muted); padding:4px 0; text-transform:uppercase; }
.cal-day { aspect-ratio:1; display:flex; align-items:center; justify-content:center; border-radius:10px; font-size:0.85rem; font-weight:700; cursor:pointer; position:relative; transition:background 0.15s; }
.cal-day:hover { background:var(--bg); }
.cal-day.other-month { color:var(--border); cursor:default; pointer-events:none; }
.cal-day.today { background:var(--navy); color:white; }
.cal-day.has-event::after { content:''; position:absolute; bottom:3px; left:50%; transform:translateX(-50%); width:5px; height:5px; border-radius:50%; background:#c084fc; }
.cal-day.has-important::after { background:#f59e0b; width:6px; height:6px; }
.cal-day.today.has-event::after { background:white; }
.cal-day.today.has-important::after { background:#fde68a; }
.cal-day.selected { outline:2px solid #c084fc; outline-offset:1px; }
.event-item { display:flex; align-items:center; gap:10px; padding:11px 14px; background:var(--white); border-radius:var(--radius-sm); margin-bottom:8px; box-shadow:var(--shadow); animation:slideUp 0.2s ease; }
.event-dot { width:10px; height:10px; border-radius:50%; background:#c084fc; flex-shrink:0; }
.event-date-badge { font-size:0.72rem; font-weight:800; color:#c084fc; background:#f5f0ff; padding:2px 8px; border-radius:999px; white-space:nowrap; }
.event-important-badge { font-size:0.72rem; font-weight:800; color:#f59e0b; background:#fffbeb; padding:2px 8px; border-radius:999px; white-space:nowrap; }
.event-item.important { border-left:3px solid #f59e0b; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.budget-big {
  text-align: center; padding: 20px 0 8px;
}
.budget-big-num { font-size: 2.8rem; font-weight: 900; letter-spacing: -1px; }
.budget-big-label { font-size: 0.82rem; color: var(--muted); font-weight: 600; }
.budget-kvar { font-size: 1rem; font-weight: 800; margin-top: 6px; }
</style>
</head>
<body>

<!-- SPLASH SCREEN -->
<div class="splash" id="splash">
  <div class="splash-logo">ğŸ </div>
  <div class="splash-title">Hemappen</div>
  <div class="splash-sub">Vem anvÃ¤nder appen pÃ¥ den hÃ¤r enheten?</div>
  <div class="splash-question">VÃ¤lj din profil</div>
  <div class="splash-btns">
    <button class="splash-btn splash-btn-p1" id="splash-p1-btn" onclick="choosePerson('p1')">
      <span id="splash-avatar-p1" style="display:flex;align-items:center"></span>
      <span id="splash-p1-name">Sanna</span>
    </button>
    <button class="splash-btn splash-btn-p2" id="splash-p2-btn" onclick="choosePerson('p2')">
      <span id="splash-avatar-p2" style="display:flex;align-items:center"></span>
      <span id="splash-p2-name">Victor</span>
    </button>
  </div>
</div>

<!-- APP HEADER -->
<div class="app-header">
  <div class="header-top">
    <div class="app-name">ğŸ  Hemappen</div>
    <div style="display:flex;align-items:center;gap:8px;flex-direction:column;align-items:flex-end">
      <div style="display:flex;align-items:center;gap:6px">
        <span id="sync-status" style="font-size:0.68rem;font-weight:700;opacity:0;transition:opacity 0.4s"></span>
        <div class="header-date" id="header-date"></div>
      </div>
      <div class="active-user-chip" id="active-user-chip" onclick="showSplash()" title="Byt anvÃ¤ndare"></div>
    </div>
  </div>
  <div class="header-summary">
    <div class="sum-card">
      <div class="sum-label">Matbudget kvar</div>
      <div class="sum-value" id="hdr-food">â€“</div>
    </div>
    <div class="sum-card">
      <div class="sum-label">Sparat totalt</div>
      <div class="sum-value" id="hdr-savings">â€“</div>
    </div>
  </div>
</div>

<!-- SCREENS -->

<!-- HEM -->
<div class="screen active" id="screen-hem">
  <div class="screen-title">VÃ¤lkommen! ğŸ‘‹</div>
  <div class="dash-grid">
    <div class="dash-tile" style="background:var(--bills-light);color:var(--bills)" onclick="gotoScreen('rakningar')">
      <div class="dash-tile-icon">ğŸ§¾</div>
      <div class="dash-tile-label">RÃ¤kningar</div>
      <div class="dash-tile-value" id="dash-bills">0 st</div>
    </div>
    <div class="dash-tile" style="background:var(--savings-light);color:var(--savings)" onclick="gotoScreen('sparmal')">
      <div class="dash-tile-icon">ğŸ¦</div>
      <div class="dash-tile-label">SparmÃ¥l</div>
      <div class="dash-tile-value" id="dash-savings">0 mÃ¥l</div>
    </div>
    <div class="dash-tile" style="background:var(--food-light);color:var(--food)" onclick="gotoScreen('mat')">
      <div class="dash-tile-icon">ğŸ›’</div>
      <div class="dash-tile-label">Matbudget</div>
      <div class="dash-tile-value" id="dash-food">â€“</div>
    </div>
    <div class="dash-tile" style="background:var(--shop-light);color:var(--shop)" onclick="gotoScreen('inkop')">
      <div class="dash-tile-icon">ğŸ“</div>
      <div class="dash-tile-label">InkÃ¶pslista</div>
      <div class="dash-tile-value" id="dash-shop">0 varor</div>
    </div>
    <div class="dash-tile" style="background:#f5f0ff;color:#c084fc;grid-column:span 2" onclick="gotoScreen('kalender')">
      <div class="dash-tile-icon">ğŸ“…</div>
      <div class="dash-tile-label">Kalender</div>
      <div class="dash-tile-value" id="dash-cal">0 hÃ¤ndelser</div>
    </div>
  </div>

  <div class="card">
    <div class="sec-title" style="margin-bottom:10px">ğŸ“… Kommande rÃ¤kningar</div>
    <div id="upcoming-bills"><div class="empty"><div class="empty-icon">ğŸ‰</div>Inga kommande rÃ¤kningar!</div></div>
  </div>
</div>

<!-- RÃ„KNINGAR -->
<div class="screen" id="screen-rakningar">
  <div class="screen-title">ğŸ§¾ RÃ¤kningar</div>
  <div class="card">
    <div class="form-row">
      <input class="inp" id="bill-name" placeholder="Namn (t.ex. El)" />
      <input class="inp" id="bill-amount" placeholder="Belopp" type="number" style="max-width:110px" />
    </div>
    <div class="form-row">
      <input class="inp" id="bill-date" type="date" />
    </div>
    <div class="person-picker" id="bill-person-picker">
      <button class="person-btn" id="bill-p1-btn" onclick="selectPerson('bill','p1')">ğŸ‘¤ <span id="bill-p1-label">Person 1</span></button>
      <button class="person-btn" id="bill-p2-btn" onclick="selectPerson('bill','p2')">ğŸ‘¤ <span id="bill-p2-label">Person 2</span></button>
      <button class="person-btn" id="bill-both-btn" onclick="selectPerson('bill','both')" style="flex:0.6;font-size:0.78rem">BÃ¥da</button>
    </div>
    <button class="btn-add" style="background:var(--bills);color:white;width:100%" onclick="addBill()">+ LÃ¤gg till</button>
  </div>
  <div id="bills-total" style="display:none" class="card" >
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <span style="font-weight:800;font-size:0.95rem">ğŸ“Š Sammanfattning</span>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div style="background:var(--bills-light);border-radius:12px;padding:12px;text-align:center">
        <div style="font-size:0.72rem;font-weight:700;color:var(--bills);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Totalt</div>
        <div style="font-size:1.2rem;font-weight:900;color:var(--bills)" id="bills-sum-total">0 kr</div>
      </div>
      <div style="background:var(--savings-light);border-radius:12px;padding:12px;text-align:center">
        <div style="font-size:0.72rem;font-weight:700;color:var(--savings);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px">Obetalt</div>
        <div style="font-size:1.2rem;font-weight:900;color:var(--savings)" id="bills-sum-unpaid">0 kr</div>
      </div>
    </div>
  </div>
  <div id="bills-list"></div>
</div>

<!-- SPARMÃ…L -->
<div class="screen" id="screen-sparmal">
  <div class="screen-title">ğŸ¦ SparmÃ¥l</div>
  <div class="card">
    <div class="form-row">
      <input class="inp" id="goal-name" placeholder="Vad sparar du till?" />
      <input class="inp" id="goal-target" placeholder="MÃ¥l (kr)" type="number" style="max-width:120px" />
    </div>
    <div class="person-picker" id="goal-person-picker">
      <button class="person-btn" id="goal-p1-btn" onclick="selectPerson('goal','p1')">ğŸ‘¤ <span id="goal-p1-label">Person 1</span></button>
      <button class="person-btn" id="goal-p2-btn" onclick="selectPerson('goal','p2')">ğŸ‘¤ <span id="goal-p2-label">Person 2</span></button>
      <button class="person-btn" id="goal-both-btn" onclick="selectPerson('goal','both')" style="flex:0.6;font-size:0.78rem">BÃ¥da</button>
    </div>
    <button class="btn-add" style="background:var(--savings);color:white;width:100%" onclick="addGoal()">+ Skapa nytt mÃ¥l</button>
  </div>
  <div id="goals-list"></div>
</div>

<!-- MATBUDGET -->
<div class="screen" id="screen-mat">
  <div class="screen-title">ğŸ›’ Matbudget</div>
  <div class="card">
    <div class="budget-big">
      <div class="budget-big-num" id="food-spent-display">0 kr</div>
      <div class="budget-big-label">spenderat denna mÃ¥nad</div>
      <div class="budget-kvar" id="food-kvar-display" style="color:var(--savings)">Budget ej angiven</div>
    </div>
    <div class="prog-wrap">
      <div class="prog-bar"><div class="prog-fill" id="food-prog" style="width:0%;background:var(--food)"></div></div>
    </div>
  </div>
  <div class="card">
    <div class="sec-title" style="margin-bottom:10px">SÃ¤tt mÃ¥nadsbudget</div>
    <div class="form-row">
      <input class="inp" id="food-budget-inp" placeholder="Budget (kr)" type="number" />
      <button class="btn-add" style="background:var(--food);color:white" onclick="setFoodBudget()">Spara</button>
    </div>
  </div>
  <div class="card">
    <div class="sec-title" style="margin-bottom:10px">Logga ett kÃ¶p</div>
    <div class="form-row">
      <input class="inp" id="food-item-name" placeholder="Vad kÃ¶pte du?" />
      <input class="inp" id="food-item-cost" placeholder="Kostnad" type="number" style="max-width:110px" />
    </div>
    <button class="btn-add" style="background:var(--food);color:white;width:100%" onclick="addFoodItem()">+ LÃ¤gg till kÃ¶p</button>
  </div>
  <div class="sec-header"><div class="sec-title">KÃ¶phistorik</div></div>
  <div id="food-list"></div>
</div>

<!-- INKÃ–PSLISTA -->
<div class="screen" id="screen-inkop">
  <div class="screen-title">ğŸ“ InkÃ¶pslista</div>
  <div class="card">
    <div class="form-row">
      <input class="inp" id="shop-item" placeholder="LÃ¤gg till vara..." />
      <button class="btn-add" style="background:var(--shop);color:white" onclick="addShopItem()">+</button>
    </div>
  </div>
  <div id="shop-list"></div>
  <div style="text-align:center;margin-top:8px">
    <button onclick="clearCheckedShop()" style="background:none;border:none;color:var(--muted);font-family:'Nunito',sans-serif;font-size:0.85rem;font-weight:700;cursor:pointer;text-decoration:underline">Rensa avbockade</button>
  </div>
</div>

<!-- KALENDER -->
<div class="screen" id="screen-kalender">
  <div class="screen-title">ğŸ“… Kalender</div>

  <div class="sec-header"><div class="sec-title" id="events-section-title">Alla hÃ¤ndelser</div></div>
  <div id="events-list"></div>

  <div class="card" style="margin-top:4px">
    <div class="cal-nav">
      <button class="cal-arrow" onclick="calPrev()">â€¹</button>
      <div class="cal-month" id="cal-month-label"></div>
      <button class="cal-arrow" onclick="calNext()">â€º</button>
    </div>
    <div class="cal-grid" id="cal-day-names"></div>
    <div class="cal-grid" id="cal-days"></div>
  </div>

  <div class="card">
    <div class="sec-title" style="margin-bottom:10px" id="cal-add-title">LÃ¤gg till hÃ¤ndelse</div>
    <div class="form-row">
      <input class="inp" id="event-name" placeholder="Vad hÃ¤nder?" />
    </div>
    <div class="form-row">
      <input class="inp" id="event-date" type="date" />
      <input class="inp" id="event-time" type="time" style="max-width:110px" />
    </div>
    <div style="margin-bottom:12px">
      <button id="important-toggle" onclick="toggleImportant()" style="
        width:100%;padding:11px;border-radius:var(--radius-sm);
        border:2px solid var(--border);background:var(--bg);
        font-family:'Nunito',sans-serif;font-size:0.9rem;font-weight:700;
        color:var(--muted);cursor:pointer;transition:all 0.2s;text-align:left;
        display:flex;align-items:center;gap:8px;">
        <span id="important-icon">â˜†</span>
        <span id="important-label">Markera som viktig hÃ¤ndelse</span>
      </button>
    </div>
    <button class="btn-add" style="background:#c084fc;color:white;width:100%" onclick="addEvent()">+ LÃ¤gg till hÃ¤ndelse</button>
  </div>
</div>

<!-- INSTÃ„LLNINGAR -->
<div class="screen" id="screen-installningar">
  <div class="screen-title">âš™ï¸ InstÃ¤llningar</div>
  <div class="card">
    <div class="sec-title" style="margin-bottom:12px">ğŸ‘¥ HushÃ¥llets namn</div>
    <div style="margin-bottom:10px">
      <div style="font-size:0.78rem;font-weight:700;color:#6366f1;margin-bottom:5px;text-transform:uppercase;letter-spacing:0.05em">Person 1</div>
      <input class="inp" id="settings-p1" placeholder="Ange namn..." style="width:100%;border-color:#6366f1" />
    </div>
    <div style="margin-bottom:14px">
      <div style="font-size:0.78rem;font-weight:700;color:#ec4899;margin-bottom:5px;text-transform:uppercase;letter-spacing:0.05em">Person 2</div>
      <input class="inp" id="settings-p2" placeholder="Ange namn..." style="width:100%;border-color:#ec4899" />
    </div>
    <button class="btn-add" style="background:var(--navy);color:white;width:100%" onclick="saveNames()">ğŸ’¾ Spara namn</button>
    <div id="names-saved-msg" style="display:none;text-align:center;color:var(--savings);font-weight:700;font-size:0.85rem;margin-top:10px">âœ“ Namn sparat!</div>
  </div>
  <div class="card">
    <div class="sec-title" style="margin-bottom:10px">ğŸ”„ Byt aktiv anvÃ¤ndare</div>
    <p style="font-size:0.85rem;color:var(--muted);margin-bottom:12px;font-weight:600;">VÃ¤ljer du om vem som anvÃ¤nder appen pÃ¥ den hÃ¤r enheten.</p>
    <button class="btn-add" style="background:var(--bg);border:2px solid var(--border);color:var(--text);width:100%;font-size:0.9rem" onclick="showSplash()">ğŸ‘¤ Byt anvÃ¤ndare</button>
  </div>
  <div class="card" style="margin-top:4px">
    <div class="sec-title" style="margin-bottom:8px">FÃ¶rhandsvisning</div>
    <div style="display:flex;gap:8px">
      <span class="person-tag tag-p1" id="preview-p1">Person 1</span>
      <span class="person-tag tag-p2" id="preview-p2">Person 2</span>
      <span class="person-tag tag-both">BÃ¥da</span>
    </div>
  </div>
</div>

<!-- MODAL: SÃ„TT IN PENGAR -->
<div class="modal-overlay" id="goal-modal">
  <div class="modal-box">
    <div class="modal-title">ğŸ’° SÃ¤tt in pengar</div>
    <div class="modal-sub" id="modal-goal-name">SparmÃ¥l</div>
    <input class="inp" id="modal-amount" type="number" placeholder="Belopp (kr)" style="width:100%;margin-bottom:0" />
    <div class="modal-actions">
      <button class="modal-btn" style="background:var(--bg);color:var(--muted)" onclick="closeModal()">Avbryt</button>
      <button class="modal-btn" style="background:var(--savings);color:white" onclick="confirmDeposit()">SÃ¤tt in âœ“</button>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="nav-btn active" onclick="gotoScreen('hem')" id="nav-hem">
    <span class="nav-icon">ğŸ </span>Hem
  </button>
  <button class="nav-btn" onclick="gotoScreen('rakningar')" id="nav-rakningar">
    <span class="nav-icon">ğŸ§¾</span>RÃ¤kningar
  </button>
  <button class="nav-btn" onclick="gotoScreen('sparmal')" id="nav-sparmal">
    <span class="nav-icon">ğŸ¦</span>SparmÃ¥l
  </button>
  <button class="nav-btn" onclick="gotoScreen('mat')" id="nav-mat">
    <span class="nav-icon">ğŸ›’</span>Mat
  </button>
  <button class="nav-btn" onclick="gotoScreen('inkop')" id="nav-inkop">
    <span class="nav-icon">ğŸ“</span>InkÃ¶p
  </button>
  <button class="nav-btn" onclick="gotoScreen('kalender')" id="nav-kalender">
    <span class="nav-icon">ğŸ“…</span>Kalender
  </button>
  <button class="nav-btn" onclick="gotoScreen('installningar')" id="nav-installningar">
    <span class="nav-icon">âš™ï¸</span>InstÃ¤lln.
  </button>
</nav>

<script>
// â”€â”€ STATE â”€â”€
let state = {
  bills: [],
  goals: [],
  foodBudget: 0,
  foodItems: [],
  shopItems: [],
  events: [],
  persons: { p1: 'Sanna', p2: 'Victor' }
};

// â”€â”€ SUPABASE SYNC â”€â”€
const SUPA_URL = 'https://yqmzdidhaeplmacxqalq.supabase.co';
const SUPA_KEY = 'sb_publishable_jLdTWaWP0VwXhZDsj36uZQ_qFVc18B7';
const SUPA_TABLE = 'app_state';
const SUPA_ROW_ID = 1;
let syncTimeout = null;
let lastSyncedAt = null;

async function supaFetch(method, body) {
  const url = `${SUPA_URL}/rest/v1/${SUPA_TABLE}?id=eq.${SUPA_ROW_ID}`;
  const res = await fetch(method === 'GET' ? `${SUPA_URL}/rest/v1/${SUPA_TABLE}?id=eq.${SUPA_ROW_ID}&select=data,updated_at` : url, {
    method,
    headers: {
      'apikey': SUPA_KEY,
      'Authorization': `Bearer ${SUPA_KEY}`,
      'Content-Type': 'application/json',
      'Prefer': method === 'POST' ? 'return=representation,resolution=merge-duplicates' : 'return=representation'
    },
    body: body ? JSON.stringify(body) : undefined
  });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}

async function saveToCloud() {
  localStorage.setItem('hemappen', JSON.stringify(state));
  try {
    await supaFetch('POST', { id: SUPA_ROW_ID, data: state, updated_at: new Date().toISOString() });
    showSyncStatus('âœ“ Synkad', '#06d6a0');
  } catch(e) {
    showSyncStatus('âš  Offline', '#ffa62b');
  }
}

async function loadFromCloud() {
  // First load from localStorage for instant render
  const local = localStorage.getItem('hemappen');
  if (local) applyParsed(JSON.parse(local));

  try {
    const rows = await supaFetch('GET');
    if (rows && rows.length && rows[0].data) {
      const remote = rows[0].data;
      lastSyncedAt = rows[0].updated_at;
      applyParsed(remote);
      localStorage.setItem('hemappen', JSON.stringify(state));
    }
  } catch(e) {
    showSyncStatus('âš  Offline â€“ lokalt lÃ¤ge', '#ffa62b');
  }
}

function applyParsed(parsed) {
  const persons = parsed.persons || { p1: 'Sanna', p2: 'Victor' };
  if (persons.p1 === 'Person 1') persons.p1 = 'Sanna';
  if (persons.p2 === 'Person 2') persons.p2 = 'Victor';
  state = {
    bills: parsed.bills || [],
    goals: parsed.goals || [],
    foodBudget: parsed.foodBudget || 0,
    foodItems: parsed.foodItems || [],
    shopItems: parsed.shopItems || [],
    events: parsed.events || [],
    persons
  };
}

function save() {
  localStorage.setItem('hemappen', JSON.stringify(state));
  clearTimeout(syncTimeout);
  syncTimeout = setTimeout(saveToCloud, 800); // debounce 800ms
}

function load() {
  const local = localStorage.getItem('hemappen');
  if (local) applyParsed(JSON.parse(local));
}

function showSyncStatus(msg, color) {
  let el = document.getElementById('sync-status');
  if (!el) return;
  el.textContent = msg;
  el.style.color = color;
  el.style.opacity = '1';
  clearTimeout(el._t);
  el._t = setTimeout(() => el.style.opacity = '0', 3000);
}

// Live polling â€” check for remote changes every 10s
function startLiveSync() {
  setInterval(async () => {
    try {
      const rows = await supaFetch('GET');
      if (rows && rows.length && rows[0].updated_at !== lastSyncedAt) {
        lastSyncedAt = rows[0].updated_at;
        const remote = rows[0].data;
        applyParsed(remote);
        localStorage.setItem('hemappen', JSON.stringify(state));
        injectNewcastleFixtures();
        renderBills(); renderGoals(); renderFood(); renderShop(); renderCal(); updateDashboard();
        updatePersonLabels(); applyDevicePerson();
        showSyncStatus('â†“ Uppdaterad', '#748ffc');
      }
    } catch(e) { /* silent */ }
  }, 10000);
}


// â”€â”€ NAVIGATION â”€â”€
function gotoScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  document.getElementById('nav-' + name).classList.add('active');
  if (name === 'kalender') renderCal();
  updateDashboard();
}

// â”€â”€ DATE â”€â”€
function formatDate(iso) {
  if (!iso) return '';
  const d = new Date(iso);
  return d.toLocaleDateString('sv-SE', { day:'numeric', month:'short' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AKTIV ENHETSPERSON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEVICE_KEY = 'hemappen_device_person';

// SVG avatars
const AVATAR_P1 = `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="20" cy="20" r="20" fill="#eef2ff"/>
  <!-- Black hair top -->
  <ellipse cx="20" cy="13" rx="9" ry="9" fill="#1a1a2e"/>
  <!-- Hair sides -->
  <rect x="11" y="13" width="4" height="8" rx="2" fill="#1a1a2e"/>
  <rect x="25" y="13" width="4" height="8" rx="2" fill="#1a1a2e"/>
  <!-- Face -->
  <ellipse cx="20" cy="17" rx="7" ry="7.5" fill="#f5c5a3"/>
  <!-- Eyes -->
  <ellipse cx="17.2" cy="16.5" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <ellipse cx="22.8" cy="16.5" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <!-- Smile -->
  <path d="M17.5 20 Q20 22 22.5 20" stroke="#c47b5a" stroke-width="1.2" stroke-linecap="round" fill="none"/>
  <!-- Long hair -->
  <path d="M12 18 Q10 26 13 30" stroke="#1a1a2e" stroke-width="4" stroke-linecap="round" fill="none"/>
  <path d="M28 18 Q30 26 27 30" stroke="#1a1a2e" stroke-width="4" stroke-linecap="round" fill="none"/>
  <!-- Body -->
  <path d="M13 32 Q13 28 20 27 Q27 28 27 32" fill="#6366f1"/>
</svg>`;

const AVATAR_P2 = `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="20" cy="20" r="20" fill="#fdf2f8"/>
  <!-- Brown hair -->
  <ellipse cx="20" cy="13" rx="8.5" ry="7.5" fill="#5c3d2e"/>
  <!-- Face -->
  <ellipse cx="20" cy="18" rx="7" ry="7.5" fill="#f5c5a3"/>
  <!-- Eyes -->
  <ellipse cx="17.2" cy="17" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <ellipse cx="22.8" cy="17" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <!-- Smile -->
  <path d="M17.5 21 Q20 23 22.5 21" stroke="#c47b5a" stroke-width="1.2" stroke-linecap="round" fill="none"/>
  <!-- Body -->
  <path d="M13 33 Q13 28 20 27 Q27 28 27 33" fill="#ec4899"/>
</svg>`;

const AVATAR_P1_SM = `<svg width="24" height="24" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="20" cy="20" r="20" fill="#eef2ff"/>
  <ellipse cx="20" cy="13" rx="9" ry="9" fill="#1a1a2e"/>
  <rect x="11" y="13" width="4" height="8" rx="2" fill="#1a1a2e"/>
  <rect x="25" y="13" width="4" height="8" rx="2" fill="#1a1a2e"/>
  <ellipse cx="20" cy="17" rx="7" ry="7.5" fill="#f5c5a3"/>
  <ellipse cx="17.2" cy="16.5" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <ellipse cx="22.8" cy="16.5" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <path d="M17.5 20 Q20 22 22.5 20" stroke="#c47b5a" stroke-width="1.2" stroke-linecap="round" fill="none"/>
  <path d="M12 18 Q10 26 13 30" stroke="#1a1a2e" stroke-width="4" stroke-linecap="round" fill="none"/>
  <path d="M28 18 Q30 26 27 30" stroke="#1a1a2e" stroke-width="4" stroke-linecap="round" fill="none"/>
  <path d="M13 32 Q13 28 20 27 Q27 28 27 32" fill="#6366f1"/>
</svg>`;

const AVATAR_P2_SM = `<svg width="24" height="24" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
  <circle cx="20" cy="20" r="20" fill="#fdf2f8"/>
  <ellipse cx="20" cy="13" rx="8.5" ry="7.5" fill="#5c3d2e"/>
  <ellipse cx="20" cy="18" rx="7" ry="7.5" fill="#f5c5a3"/>
  <ellipse cx="17.2" cy="17" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <ellipse cx="22.8" cy="17" rx="1.2" ry="1.3" fill="#2d2d2d"/>
  <path d="M17.5 21 Q20 23 22.5 21" stroke="#c47b5a" stroke-width="1.2" stroke-linecap="round" fill="none"/>
  <path d="M13 33 Q13 28 20 27 Q27 28 27 33" fill="#ec4899"/>
</svg>`;

function getDevicePerson() {
  return localStorage.getItem(DEVICE_KEY);
}

function choosePerson(key) {
  localStorage.setItem(DEVICE_KEY, key);
  document.getElementById('splash').classList.add('hidden');
  applyDevicePerson();
}

function showSplash() {
  document.getElementById('splash-p1-name').textContent = state.persons.p1 || 'Sanna';
  document.getElementById('splash-p2-name').textContent = state.persons.p2 || 'Victor';
  document.getElementById('splash').classList.remove('hidden');
}

function applyDevicePerson() {
  const key = getDevicePerson();
  if (!key) return;
  const name  = key === 'p1' ? (state.persons.p1 || 'Sanna') : (state.persons.p2 || 'Victor');
  const color = key === 'p1' ? '#6366f1' : '#ec4899';
  const bg    = key === 'p1' ? '#eef2ff'  : '#fdf2f8';
  const avatarSm = key === 'p1' ? AVATAR_P1_SM : AVATAR_P2_SM;

  // Update header chip
  const chip = document.getElementById('active-user-chip');
  chip.style.background = bg;
  chip.style.color = color;
  chip.innerHTML = `${avatarSm}<span style="font-weight:800">${name}</span> <span style="opacity:0.5;font-size:0.65rem">byt</span>`;

  // Update splash avatars
  document.getElementById('splash-avatar-p1').innerHTML = AVATAR_P1;
  document.getElementById('splash-avatar-p2').innerHTML = AVATAR_P2;

  // Auto-select person in forms
  selectedPerson.bill = key;
  selectedPerson.goal = key;
  ['bill','goal'].forEach(ctx => {
    ['p1','p2','both'].forEach(p => {
      const btn = document.getElementById(ctx + '-' + p + '-btn');
      if (btn) btn.className = 'person-btn' + (p === key ? (key === 'p1' ? ' selected-p1' : ' selected-p2') : '');
    });
  });
}

function initDevicePerson() {
  // Always render avatars on splash
  document.getElementById('splash-avatar-p1').innerHTML = AVATAR_P1;
  document.getElementById('splash-avatar-p2').innerHTML = AVATAR_P2;
  document.getElementById('splash-p1-name').textContent = state.persons.p1 || 'Sanna';
  document.getElementById('splash-p2-name').textContent = state.persons.p2 || 'Victor';
  const key = getDevicePerson();
  if (!key) {
    document.getElementById('splash').classList.remove('hidden');
  } else {
    document.getElementById('splash').classList.add('hidden');
    applyDevicePerson();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PERSONER & INSTÃ„LLNINGAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedPerson = { bill: null, goal: null };

function getPersonName(key) {
  if (key === 'p1') return state.persons.p1 || 'Person 1';
  if (key === 'p2') return state.persons.p2 || 'Person 2';
  if (key === 'both') return 'BÃ¥da';
  return '';
}

function selectPerson(context, person) {
  selectedPerson[context] = selectedPerson[context] === person ? null : person;
  const p1Btn = document.getElementById(context + '-p1-btn');
  const p2Btn = document.getElementById(context + '-p2-btn');
  const bothBtn = document.getElementById(context + '-both-btn');
  p1Btn.className = 'person-btn' + (selectedPerson[context] === 'p1' ? ' selected-p1' : '');
  p2Btn.className = 'person-btn' + (selectedPerson[context] === 'p2' ? ' selected-p2' : '');
  bothBtn.className = 'person-btn' + (selectedPerson[context] === 'both' ? ' selected-p1' : '');
}

function getPersonTag(person) {
  if (!person) return '';
  if (person === 'p1') return `<span class="person-tag tag-p1">${getPersonName('p1')}</span>`;
  if (person === 'p2') return `<span class="person-tag tag-p2">${getPersonName('p2')}</span>`;
  if (person === 'both') return `<span class="person-tag tag-both">BÃ¥da</span>`;
  return '';
}

function updatePersonLabels() {
  const p1 = state.persons.p1 || 'Person 1';
  const p2 = state.persons.p2 || 'Person 2';
  ['bill','goal'].forEach(ctx => {
    const el1 = document.getElementById(ctx + '-p1-label');
    const el2 = document.getElementById(ctx + '-p2-label');
    if (el1) el1.textContent = p1;
    if (el2) el2.textContent = p2;
  });
  const prev1 = document.getElementById('preview-p1');
  const prev2 = document.getElementById('preview-p2');
  if (prev1) prev1.textContent = p1;
  if (prev2) prev2.textContent = p2;
  const inp1 = document.getElementById('settings-p1');
  const inp2 = document.getElementById('settings-p2');
  if (inp1) inp1.value = p1 !== 'Person 1' ? p1 : '';
  if (inp2) inp2.value = p2 !== 'Person 2' ? p2 : '';
}

function saveNames() {
  const p1 = document.getElementById('settings-p1').value.trim() || 'Person 1';
  const p2 = document.getElementById('settings-p2').value.trim() || 'Victor';
  state.persons = { p1, p2 };
  save();
  updatePersonLabels();
  applyDevicePerson();
  const msg = document.getElementById('names-saved-msg');
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 2000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RÃ„KNINGAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addBill() {
  const name = document.getElementById('bill-name').value.trim();
  const amount = parseFloat(document.getElementById('bill-amount').value);
  const date = document.getElementById('bill-date').value;
  if (!name || !amount) return alert('Fyll i namn och belopp!');
  const person = selectedPerson.bill || getDevicePerson();
  state.bills.push({ id: Date.now(), name, amount, date, paid: false, person });
  save();
  document.getElementById('bill-name').value = '';
  document.getElementById('bill-amount').value = '';
  document.getElementById('bill-date').value = '';
  // Re-apply device person selection
  applyDevicePerson();
  renderBills();
}

function toggleBill(id) {
  const b = state.bills.find(b => b.id === id);
  if (b) { b.paid = !b.paid; save(); renderBills(); updateDashboard(); }
}

function deleteBill(id) {
  state.bills = state.bills.filter(b => b.id !== id);
  save(); renderBills(); updateDashboard();
}

function renderBills() {
  const el = document.getElementById('bills-list');
  const totalEl = document.getElementById('bills-total');
  if (!state.bills.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ§¾</div>Inga rÃ¤kningar Ã¤nnu</div>';
    totalEl.style.display = 'none';
    return;
  }
  totalEl.style.display = 'block';
  const total = state.bills.reduce((s, b) => s + b.amount, 0);
  const unpaidTotal = state.bills.filter(b => !b.paid).reduce((s, b) => s + b.amount, 0);
  document.getElementById('bills-sum-total').textContent = total.toLocaleString('sv-SE') + ' kr';
  document.getElementById('bills-sum-unpaid').textContent = unpaidTotal.toLocaleString('sv-SE') + ' kr';
  const sorted = [...state.bills].sort((a,b) => (a.date||'') < (b.date||'') ? -1 : 1);
  el.innerHTML = sorted.map(b => `
    <div class="list-item ${b.paid ? 'bill-item-paid' : ''}">
      <div class="item-check ${b.paid ? 'checked' : ''}" onclick="toggleBill(${b.id})">${b.paid ? 'âœ“' : ''}</div>
      <div style="flex:1">
        <div class="item-text ${b.paid ? 'checked-text' : ''}">${b.name}</div>
        ${b.date ? `<div class="item-sub">FÃ¶rfaller ${formatDate(b.date)}</div>` : ''}
      </div>
      ${getPersonTag(b.person)}
      <div class="item-amount" style="color:var(--bills)">${b.amount.toLocaleString('sv-SE')} kr</div>
      <button class="item-del" onclick="deleteBill(${b.id})">ğŸ—‘</button>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPARMÃ…L
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addGoal() {
  const name = document.getElementById('goal-name').value.trim();
  const target = parseFloat(document.getElementById('goal-target').value);
  if (!name || !target) return alert('Fyll i namn och mÃ¥lbelopp!');
  const person = selectedPerson.goal || getDevicePerson();
  state.goals.push({ id: Date.now(), name, target, saved: 0, person });
  save();
  document.getElementById('goal-name').value = '';
  document.getElementById('goal-target').value = '';
  applyDevicePerson();
  renderGoals();
}

let activeGoalId = null;

function addToGoal(id) {
  activeGoalId = id;
  const g = state.goals.find(g => g.id === id);
  document.getElementById('modal-goal-name').textContent = g ? g.name : 'SparmÃ¥l';
  document.getElementById('modal-amount').value = '';
  document.getElementById('goal-modal').classList.add('open');
  setTimeout(() => document.getElementById('modal-amount').focus(), 100);
}

function closeModal() {
  document.getElementById('goal-modal').classList.remove('open');
  activeGoalId = null;
}

function confirmDeposit() {
  const amt = parseFloat(document.getElementById('modal-amount').value);
  if (!amt || amt <= 0) { document.getElementById('modal-amount').focus(); return; }
  const g = state.goals.find(g => g.id === activeGoalId);
  if (g) { g.saved = Math.min(g.saved + amt, g.target); save(); renderGoals(); updateDashboard(); }
  closeModal();
}

// Close modal on overlay click
document.getElementById('goal-modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

function deleteGoal(id) {
  state.goals = state.goals.filter(g => g.id !== id);
  save(); renderGoals(); updateDashboard();
}

function renderGoals() {
  const el = document.getElementById('goals-list');
  if (!state.goals.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ¦</div>Inga sparmÃ¥l Ã¤nnu</div>';
    return;
  }
  el.innerHTML = state.goals.map(g => {
    const pct = g.target > 0 ? Math.round((g.saved / g.target) * 100) : 0;
    const done = pct >= 100;
    return `
    <div class="card goal-card">
      <div style="display:flex;justify-content:space-between;align-items:start">
        <div>
          <div class="goal-name">${g.name} ${done ? 'ğŸ‰' : ''}</div>
          <div class="goal-amounts">${g.saved.toLocaleString('sv-SE')} kr av ${g.target.toLocaleString('sv-SE')} kr</div>
          ${g.person ? `<div style="margin-top:4px">${getPersonTag(g.person)}</div>` : ''}
        </div>
        <span class="badge" style="background:var(--savings-light);color:var(--savings)">${pct}%</span>
      </div>
      <div class="prog-wrap">
        <div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:var(--savings)"></div></div>
      </div>
      <div class="goal-actions">
        <button class="goal-btn" style="background:var(--savings-light);color:var(--savings)" onclick="addToGoal(${g.id})">+ SÃ¤tt in pengar</button>
        <button class="goal-btn" style="background:#fff0f0;color:var(--bills);max-width:44px" onclick="deleteGoal(${g.id})">ğŸ—‘</button>
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATBUDGET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFoodBudget() {
  const val = parseFloat(document.getElementById('food-budget-inp').value);
  if (!val || val <= 0) return alert('Ange ett giltigt belopp!');
  state.foodBudget = val;
  save(); renderFood();
  document.getElementById('food-budget-inp').value = '';
}

function addFoodItem() {
  const name = document.getElementById('food-item-name').value.trim();
  const cost = parseFloat(document.getElementById('food-item-cost').value);
  if (!name || !cost) return alert('Fyll i vad du kÃ¶pte och kostnaden!');
  state.foodItems.push({ id: Date.now(), name, cost, date: new Date().toLocaleDateString('sv-SE') });
  save();
  document.getElementById('food-item-name').value = '';
  document.getElementById('food-item-cost').value = '';
  renderFood(); updateDashboard();
}

function deleteFoodItem(id) {
  state.foodItems = state.foodItems.filter(f => f.id !== id);
  save(); renderFood(); updateDashboard();
}

function renderFood() {
  const spent = state.foodItems.reduce((s, f) => s + f.cost, 0);
  const budget = state.foodBudget;
  const kvar = budget - spent;
  const pct = budget > 0 ? Math.min(100, Math.round((spent / budget) * 100)) : 0;
  const over = kvar < 0;

  document.getElementById('food-spent-display').textContent = spent.toLocaleString('sv-SE') + ' kr';
  document.getElementById('food-kvar-display').textContent = budget > 0
    ? (over ? `${Math.abs(kvar).toLocaleString('sv-SE')} kr Ã–VER budget` : `${kvar.toLocaleString('sv-SE')} kr kvar av ${budget.toLocaleString('sv-SE')} kr`)
    : 'Budget ej angiven';
  document.getElementById('food-kvar-display').style.color = over ? 'var(--bills)' : 'var(--savings)';
  document.getElementById('food-prog').style.width = pct + '%';
  document.getElementById('food-prog').style.background = over ? 'var(--bills)' : 'var(--food)';

  const el = document.getElementById('food-list');
  if (!state.foodItems.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ›’</div>Inga kÃ¶p loggade Ã¤nnu</div>';
    return;
  }
  el.innerHTML = [...state.foodItems].reverse().map(f => `
    <div class="list-item">
      <span style="font-size:1.2rem">ğŸ§¾</span>
      <div style="flex:1">
        <div class="item-text">${f.name}</div>
        <div class="item-sub">${f.date}</div>
      </div>
      <div class="item-amount" style="color:var(--food)">${f.cost.toLocaleString('sv-SE')} kr</div>
      <button class="item-del" onclick="deleteFoodItem(${f.id})">ğŸ—‘</button>
    </div>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INKÃ–PSLISTA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addShopItem() {
  const val = document.getElementById('shop-item').value.trim();
  if (!val) return;
  state.shopItems.push({ id: Date.now(), name: val, checked: false });
  save();
  document.getElementById('shop-item').value = '';
  renderShop();
}

function toggleShop(id) {
  const s = state.shopItems.find(s => s.id === id);
  if (s) { s.checked = !s.checked; save(); renderShop(); updateDashboard(); }
}

function deleteShopItem(id) {
  state.shopItems = state.shopItems.filter(s => s.id !== id);
  save(); renderShop(); updateDashboard();
}

function clearCheckedShop() {
  state.shopItems = state.shopItems.filter(s => !s.checked);
  save(); renderShop(); updateDashboard();
}

function renderShop() {
  const el = document.getElementById('shop-list');
  if (!state.shopItems.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“</div>InkÃ¶pslistan Ã¤r tom</div>';
    return;
  }
  const unchecked = state.shopItems.filter(s => !s.checked);
  const checked = state.shopItems.filter(s => s.checked);
  const renderItem = s => `
    <div class="list-item">
      <div class="item-check ${s.checked ? 'checked' : ''}" onclick="toggleShop(${s.id})">${s.checked ? 'âœ“' : ''}</div>
      <div class="item-text ${s.checked ? 'checked-text' : ''}">${s.name}</div>
      <button class="item-del" onclick="deleteShopItem(${s.id})">ğŸ—‘</button>
    </div>`;
  el.innerHTML = [...unchecked, ...checked].map(renderItem).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateDashboard() {
  // Bills tile
  const unpaid = state.bills.filter(b => !b.paid).length;
  document.getElementById('dash-bills').textContent = unpaid + ' obetald' + (unpaid === 1 ? '' : 'a');

  // Savings tile
  document.getElementById('dash-savings').textContent = state.goals.length + ' mÃ¥l';

  // Food tile
  const spent = state.foodItems.reduce((s, f) => s + f.cost, 0);
  const kvar = state.foodBudget - spent;
  document.getElementById('dash-food').textContent = state.foodBudget > 0 ? kvar.toLocaleString('sv-SE') + ' kr kvar' : 'Ej satt';

  // Shop tile
  const remaining = state.shopItems.filter(s => !s.checked).length;
  document.getElementById('dash-shop').textContent = remaining + ' var' + (remaining === 1 ? 'a' : 'or');

  // Calendar tile
  document.getElementById('dash-cal').textContent = state.events.length + ' hÃ¤ndels' + (state.events.length === 1 ? 'e' : 'er');
  const totalSaved = state.goals.reduce((s, g) => s + g.saved, 0);
  document.getElementById('hdr-food').textContent = state.foodBudget > 0 ? kvar.toLocaleString('sv-SE') + ' kr' : 'â€“';
  document.getElementById('hdr-savings').textContent = totalSaved.toLocaleString('sv-SE') + ' kr';

  // Upcoming bills
  const today = new Date(); today.setHours(0,0,0,0);
  const soon = state.bills
    .filter(b => !b.paid && b.date)
    .filter(b => { const d = new Date(b.date); return d >= today; })
    .sort((a,b) => a.date < b.date ? -1 : 1)
    .slice(0, 3);
  const upEl = document.getElementById('upcoming-bills');
  if (!soon.length) {
    upEl.innerHTML = '<div class="empty" style="padding:10px"><div class="empty-icon">ğŸ‰</div>Inga kommande rÃ¤kningar!</div>';
  } else {
    upEl.innerHTML = soon.map(b => `
      <div class="list-item" style="box-shadow:none;border:1px solid var(--border);margin-bottom:6px">
        <span style="font-size:1.1rem">ğŸ§¾</span>
        <div style="flex:1"><div class="item-text">${b.name}</div><div class="item-sub">${formatDate(b.date)}</div></div>
        <div class="item-amount" style="color:var(--bills)">${b.amount.toLocaleString('sv-SE')} kr</div>
      </div>`).join('');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KALENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let calYear, calMonth, calSelectedDate = null;

function initCal() {
  const now = new Date();
  calYear = now.getFullYear();
  calMonth = now.getMonth();
  renderCal();
}

function calPrev() { calMonth--; if (calMonth < 0) { calMonth = 11; calYear--; } renderCal(); }
function calNext() { calMonth++; if (calMonth > 11) { calMonth = 0; calYear++; } renderCal(); }

function renderCal() {
  const dayNames = ['MÃ¥n','Tis','Ons','Tor','Fre','LÃ¶r','SÃ¶n'];
  document.getElementById('cal-day-names').innerHTML = dayNames.map(d => `<div class="cal-day-name">${d}</div>`).join('');

  const monthNames = ['Januari','Februari','Mars','April','Maj','Juni','Juli','Augusti','September','Oktober','November','December'];
  document.getElementById('cal-month-label').textContent = monthNames[calMonth] + ' ' + calYear;

  const today = new Date(); today.setHours(0,0,0,0);
  const firstDay = new Date(calYear, calMonth, 1);
  // Monday-based: 0=Mon..6=Sun
  let startDow = firstDay.getDay(); // 0=Sun
  startDow = startDow === 0 ? 6 : startDow - 1;
  const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();

  // Event lookup set
  const eventDates = new Set(state.events.filter(e => !e.important).map(e => e.date));
  const importantDates = new Set(state.events.filter(e => e.important).map(e => e.date));

  let html = '';
  // prev month filler
  const daysInPrev = new Date(calYear, calMonth, 0).getDate();
  for (let i = startDow - 1; i >= 0; i--) {
    html += `<div class="cal-day other-month">${daysInPrev - i}</div>`;
  }
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = calYear + '-' + String(calMonth+1).padStart(2,'0') + '-' + String(d).padStart(2,'0');
    const isToday = new Date(calYear, calMonth, d).getTime() === today.getTime();
    const hasEv = eventDates.has(dateStr);
    const hasImp = importantDates.has(dateStr);
    const isSel = calSelectedDate === dateStr;
    const cls = ['cal-day', isToday?'today':'', hasImp?'has-important':(hasEv?'has-event':''), isSel?'selected':''].filter(Boolean).join(' ');
    html += `<div class="${cls}" onclick="selectCalDay('${dateStr}')">${d}</div>`;
  }
  // next month filler
  const total = startDow + daysInMonth;
  const remaining = total % 7 === 0 ? 0 : 7 - (total % 7);
  for (let d = 1; d <= remaining; d++) html += `<div class="cal-day other-month">${d}</div>`;

  document.getElementById('cal-days').innerHTML = html;
  renderEvents();
}

function selectCalDay(dateStr) {
  calSelectedDate = calSelectedDate === dateStr ? null : dateStr;
  document.getElementById('event-date').value = dateStr || '';
  // Update section title
  const titleEl = document.getElementById('events-section-title');
  if (calSelectedDate) {
    const d = new Date(dateStr + 'T00:00:00');
    titleEl.textContent = 'HÃ¤ndelser ' + d.toLocaleDateString('sv-SE', { day:'numeric', month:'long' });
  } else {
    titleEl.textContent = 'Alla hÃ¤ndelser';
  }
  renderCal();
}

let eventIsImportant = false;

function toggleImportant() {
  eventIsImportant = !eventIsImportant;
  const btn = document.getElementById('important-toggle');
  const icon = document.getElementById('important-icon');
  const label = document.getElementById('important-label');
  if (eventIsImportant) {
    btn.style.borderColor = '#f59e0b';
    btn.style.background = '#fffbeb';
    btn.style.color = '#f59e0b';
    icon.textContent = 'â˜…';
    label.textContent = 'Viktig hÃ¤ndelse (visas alltid)';
  } else {
    btn.style.borderColor = 'var(--border)';
    btn.style.background = 'var(--bg)';
    btn.style.color = 'var(--muted)';
    icon.textContent = 'â˜†';
    label.textContent = 'Markera som viktig hÃ¤ndelse';
  }
}

function addEvent() {
  const name = document.getElementById('event-name').value.trim();
  const date = document.getElementById('event-date').value;
  const time = document.getElementById('event-time').value;
  if (!name || !date) return alert('Fyll i vad som hÃ¤nder och vilket datum!');
  state.events.push({ id: Date.now(), name, date, time, important: eventIsImportant });
  state.events.sort((a,b) => (a.date+a.time) < (b.date+b.time) ? -1 : 1);
  save();
  document.getElementById('event-name').value = '';
  document.getElementById('event-time').value = '';
  // reset important toggle
  eventIsImportant = false;
  const btn = document.getElementById('important-toggle');
  btn.style.borderColor = 'var(--border)';
  btn.style.background = 'var(--bg)';
  btn.style.color = 'var(--muted)';
  document.getElementById('important-icon').textContent = 'â˜†';
  document.getElementById('important-label').textContent = 'Markera som viktig hÃ¤ndelse';
  renderCal();
  updateDashboard();
}

function deleteEvent(id) {
  state.events = state.events.filter(e => e.id !== id);
  save(); renderCal(); updateDashboard();
}

function renderEvents() {
  const el = document.getElementById('events-list');
  const titleEl = document.getElementById('events-section-title');

  const today = new Date(); today.setHours(0,0,0,0);
  const in30 = new Date(today); in30.setDate(today.getDate() + 30);

  let list;
  if (calSelectedDate) {
    list = state.events.filter(e => e.date === calSelectedDate);
    const d = new Date(calSelectedDate + 'T00:00:00');
    titleEl.textContent = 'HÃ¤ndelser ' + d.toLocaleDateString('sv-SE', { day:'numeric', month:'long' });
  } else {
    const within30 = state.events.filter(e => {
      const d = new Date(e.date + 'T00:00:00');
      return d >= today && d <= in30;
    });
    const importantOutside = state.events.filter(e => {
      const d = new Date(e.date + 'T00:00:00');
      return e.important && (d < today || d > in30);
    });
    // Merge without duplicates
    const seen = new Set(within30.map(e => e.id));
    const merged = [...within30, ...importantOutside.filter(e => !seen.has(e.id))];
    list = merged.sort((a,b) => (a.date + (a.time||'')) < (b.date + (b.time||'')) ? -1 : 1);
    titleEl.textContent = 'Kommande 30 dagarna + viktiga';
  }

  if (!list.length) {
    el.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ“…</div>${calSelectedDate ? 'Inga hÃ¤ndelser denna dag' : 'Inga hÃ¤ndelser de nÃ¤rmsta 30 dagarna'}</div>`;
    return;
  }

  el.innerHTML = list.map(e => {
    const d = new Date(e.date + 'T00:00:00');
    const isToday = d.getTime() === today.getTime();
    const isTomorrow = d.getTime() === today.getTime() + 86400000;
    let dateLabel;
    if (isToday) dateLabel = 'Idag';
    else if (isTomorrow) dateLabel = 'Imorgon';
    else dateLabel = d.toLocaleDateString('sv-SE', { day:'numeric', month:'short' });

    return `
    <div class="event-item${e.important ? ' important' : ''}">
      <div class="event-dot" style="background:${e.important ? '#f59e0b' : '#c084fc'}"></div>
      <div style="flex:1">
        <div class="item-text">${e.important ? 'â˜… ' : ''}${e.name}</div>
        ${e.time ? `<div class="item-sub">ğŸ• ${e.time}</div>` : ''}
      </div>
      <span class="${e.important ? 'event-important-badge' : 'event-date-badge'}">${dateLabel}</span>
      <button class="item-del" onclick="deleteEvent(${e.id})">ğŸ—‘</button>
    </div>`;
  }).join('');
}

// â”€â”€ NEWCASTLE FIXTURES â”€â”€
// Alla tider i UTC, konverteras automatiskt till svensk tid (CET/CEST)
const NEWCASTLE_FIXTURES = [
  { date: '2026-02-28', utcTime: '15:00', home: 'Newcastle', away: 'Everton',           comp: 'Premier League' },
  { date: '2026-03-04', utcTime: '20:15', home: 'Newcastle', away: 'Man United',         comp: 'Premier League' },
  { date: '2026-03-07', utcTime: '20:00', home: 'Newcastle', away: 'Man City',           comp: 'FA Cup' },
  { date: '2026-03-10', utcTime: '20:00', home: 'Newcastle', away: 'Barcelona',          comp: 'Champions League' },
  { date: '2026-03-14', utcTime: '17:30', home: 'Chelsea',   away: 'Newcastle',          comp: 'Premier League' },
  { date: '2026-03-18', utcTime: '17:45', home: 'Barcelona', away: 'Newcastle',          comp: 'Champions League' },
  { date: '2026-03-22', utcTime: '12:00', home: 'Newcastle', away: 'Sunderland',         comp: 'Premier League' },
  { date: '2026-04-11', utcTime: '14:00', home: 'Crystal Palace', away: 'Newcastle',     comp: 'Premier League' },
  { date: '2026-04-18', utcTime: '14:00', home: 'Newcastle', away: 'Bournemouth',        comp: 'Premier League' },
  { date: '2026-04-25', utcTime: '14:00', home: 'Arsenal',   away: 'Newcastle',          comp: 'Premier League' },
  { date: '2026-05-02', utcTime: '14:00', home: 'Newcastle', away: 'Brighton',           comp: 'Premier League' },
  { date: '2026-05-17', utcTime: '14:00', home: 'Newcastle', away: 'Leicester',          comp: 'Premier League' },
  { date: '2026-05-24', utcTime: '14:00', home: 'Fulham',    away: 'Newcastle',          comp: 'Premier League' },
];

function utcToSwedish(dateStr, utcTime) {
  const dt = new Date(dateStr + 'T' + utcTime + ':00Z');
  return dt.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit', timeZone: 'Europe/Stockholm' });
}

function injectNewcastleFixtures() {
  // Fix any previously saved Newcastle fixtures that had important: true
  state.events.forEach(e => { if (e._newcastle) e.important = false; });

  const existingIds = new Set(state.events.filter(e => e._newcastle).map(e => e._fixtureKey));
  NEWCASTLE_FIXTURES.forEach(f => {
    const key = f.date + f.home + f.away;
    if (existingIds.has(key)) return;
    const svTime = utcToSwedish(f.date, f.utcTime);
    const isHome = f.home === 'Newcastle';
    const opponent = isHome ? f.away : f.home;
    const venue = isHome ? '(Hemma)' : '(Borta)';
    state.events.push({
      id: Date.now() + Math.random(),
      name: `âš½ Newcastle vs ${opponent} ${venue} â€” ${f.comp}`,
      date: f.date,
      time: svTime,
      important: false,
      _newcastle: true,
      _fixtureKey: key
    });
  });
  state.events.sort((a,b) => (a.date+(a.time||'')) < (b.date+(b.time||'')) ? -1 : 1);
  save();
}

// â”€â”€ ENTER KEY SUPPORT â”€â”€
document.getElementById('modal-amount').addEventListener('keydown', e => { if(e.key==='Enter') confirmDeposit(); });
document.getElementById('shop-item').addEventListener('keydown', e => { if(e.key==='Enter') addShopItem(); });
document.getElementById('bill-name').addEventListener('keydown', e => { if(e.key==='Enter') document.getElementById('bill-amount').focus(); });
document.getElementById('goal-name').addEventListener('keydown', e => { if(e.key==='Enter') document.getElementById('goal-target').focus(); });
document.getElementById('food-item-name').addEventListener('keydown', e => { if(e.key==='Enter') addFoodItem(); });

// â”€â”€ DATE HEADER â”€â”€
document.getElementById('header-date').textContent = new Date().toLocaleDateString('sv-SE', { weekday:'long', day:'numeric', month:'long' });

// â”€â”€ INIT â”€â”€
async function init() {
  load(); // instant local render
  injectNewcastleFixtures();
  updatePersonLabels();
  initDevicePerson();
  renderBills();
  renderGoals();
  renderFood();
  renderShop();
  initCal();
  updateDashboard();

  await loadFromCloud(); // fetch latest from Supabase
  injectNewcastleFixtures();
  updatePersonLabels();
  applyDevicePerson();
  renderBills();
  renderGoals();
  renderFood();
  renderShop();
  initCal();
  updateDashboard();

  startLiveSync(); // poll every 10s for changes from other device
}

init();
</script>
</body>
</html>
